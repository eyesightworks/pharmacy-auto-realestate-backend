<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Eyesightworks Admin Portal</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
body{
margin:0;
font-family:'Inter',sans-serif;
background:#0f172a;
color:#fff;
display:flex;
align-items:center;
justify-content:center;
height:100vh;
}

.card{
background:#1e293b;
padding:40px;
border-radius:16px;
width:400px;
max-width:95%;
box-shadow:0 20px 50px rgba(0,0,0,0.4);
}

h1{
margin-bottom:10px;
}

.subtitle{
color:#94a3b8;
font-size:14px;
margin-bottom:30px;
}

input{
width:100%;
padding:12px;
margin-bottom:15px;
border-radius:8px;
border:none;
background:#334155;
color:white;
}

button{
width:100%;
padding:12px;
border:none;
border-radius:8px;
background:#3b82f6;
color:white;
font-weight:600;
cursor:pointer;
margin-bottom:10px;
}

button:hover{
background:#2563eb;
}

.dashboard{
display:none;
}

.user-box{
background:#334155;
padding:15px;
border-radius:8px;
margin-bottom:20px;
font-size:13px;
}

.logout{
background:#ef4444;
}

.logout:hover{
background:#dc2626;
}

.api-box{
margin-top:20px;
background:#0f172a;
padding:15px;
border-radius:8px;
font-size:12px;
overflow:auto;
max-height:200px;
white-space:pre-wrap;
}
</style>
</head>
<body>

<div class="card">

<div id="loginSection">
<h1>Eyesightworks</h1>
<div class="subtitle">Enterprise Management Portal</div>

<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="dashboard" id="dashboard">
<h1>Eyesightworks Dashboard</h1>
<div class="subtitle">Admin Control Panel</div>

<div class="user-box" id="userInfo"></div>

<button onclick="loadVehicles()">Load Vehicles</button>
<button onclick="loadProducts()">Load Products</button>

<button class="logout" onclick="logout()">Logout</button>

<div class="api-box" id="apiResponse"></div>
</div>

</div>

<script>

// ðŸ”¥ PRODUCTION BACKEND URL
const API = "https://pharmacy-auto-realestate-backend.onrender.com/api"

function saveToken(token){
localStorage.setItem("token",token)
}

function getToken(){
return localStorage.getItem("token")
}

function logout(){
localStorage.removeItem("token")
location.reload()
}

async function login(){
const email=document.getElementById("email").value
const password=document.getElementById("password").value

try{
const res = await fetch(API+"/auth/login",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email,password})
})

if(!res.ok){
throw new Error("Login failed")
}

const data = await res.json()

if(data.access_token){
saveToken(data.access_token)
showDashboard()
}else{
alert("Invalid Login")
}

}catch(err){
alert("Server error. Check backend.")
}
}

function parseJwt(token){
try{
return JSON.parse(atob(token.split(".")[1]))
}catch{
return null
}
}

function showDashboard(){
document.getElementById("loginSection").style.display="none"
document.getElementById("dashboard").style.display="block"

const token = getToken()
const payload = parseJwt(token)

if(payload){
document.getElementById("userInfo").innerHTML = `
<b>User Info</b><br>
Email: ${payload.email}<br>
Role: ${payload.role}
`
}
}

async function apiGet(endpoint){
try{
const res = await fetch(API+endpoint,{
headers:{
Authorization:"Bearer "+getToken()
}
})

if(!res.ok){
throw new Error("Request failed")
}

return await res.json()

}catch(err){
return { error: "Backend not reachable or unauthorized." }
}
}

async function loadVehicles(){
const data = await apiGet("/vehicles")
document.getElementById("apiResponse").innerText = JSON.stringify(data,null,2)
}

async function loadProducts(){
const data = await apiGet("/products")
document.getElementById("apiResponse").innerText = JSON.stringify(data,null,2)
}

// Auto login if token exists
if(getToken()){
showDashboard()
}

</script>

</body>
</html>